<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Acompanhamento de Viagem - UberPB</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body { margin: 0; font-family: sans-serif; }
        #map { height: 100vh; width: 100vw; }
        .info-box {
            position: absolute; top: 10px; right: 10px; background: white;
            padding: 10px; border: 1px solid #ccc; border-radius: 5px;
            z-index: 1000; font-size: 14px;
        }
    </style>
</head>
<body>
<div id="map"></div>
<div id="info" class="info-box">Carregando dados da viagem...</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="dados_viagem.js"></script>

<script>
    const map = L.map('map').setView([(carro_pos.lat + destino.lat) / 2, (carro_pos.lon + destino.lon) / 2], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    L.marker([carro_pos.lat, carro_pos.lon]).addTo(map).bindPopup(`<b>Origem_Motorista</b>`);
    L.marker([origem.lat, origem.lon]).addTo(map).bindPopup(`<b>Ponto de Encontro:</b> ${origem.desc}`);
    L.marker([destino.lat, destino.lon]).addTo(map).bindPopup(`<b>Destino Final:</b> ${destino.desc}`);

    // --- ROTAS (2 LINHAS) ---
    // Rota 1: Motorista -> Passageiro (Tracejada)
    L.polyline([[carro_pos.lat, carro_pos.lon], [origem.lat, origem.lon]], {color: 'red', dashArray: '5, 10'}).addTo(map);
    // Rota 2: Passageiro -> Destino (SÃ³lida)
    L.polyline([[origem.lat, origem.lon], [destino.lat, destino.lon]], {color: 'blue'}).addTo(map);

    document.getElementById('info').innerHTML = `De: <b>${origem.desc}</b><br>Para: <b>${destino.desc}</b>`;

    const carIcon = L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/1048/1048314.png',
        iconSize: [38, 38]
    });
    const carMarker = L.marker([carro_pos.lat, carro_pos.lon], {icon: carIcon}).addTo(map);

    function atualizarPosicao() {
        const head = document.getElementsByTagName('head')[0];
        const oldScript = document.getElementById('trip-data-script');
        if (oldScript) head.removeChild(oldScript);

        const newScript = document.createElement('script');
        newScript.id = 'trip-data-script';
        newScript.src = 'dados_viagem.js?' + new Date().getTime();
        head.appendChild(newScript);

        newScript.onload = () => {
            carMarker.setLatLng([carro_pos.lat, carro_pos.lon]);
        };
    }
    setInterval(atualizarPosicao, 3000);
</script>
</body>
</html>